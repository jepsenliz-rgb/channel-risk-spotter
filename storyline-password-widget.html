<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Strength Check</title>
    <style>
        /* =================================================================
           CONFIG & CSS VARIABLES - Storyline Optimized
        ================================================================= */
        :root {
            --color-dark-neutral: #1C2C4C;
            --color-primary: #1A6EF6;
            --color-cta: #F76C5E;
            --color-background: #FFFFFF;
            --color-border: #E8ECF3;
            --color-background-soft: #F7F9FC;
            --color-success: #1C9E6F;
            --color-warning: #F0A35E;
            --font-family: -apple-system, BlinkMacSystemFont, "Noto Sans", Roboto, Inter, Arial, sans-serif;
        }

        /* =================================================================
           RESET & BASE STYLES - Storyline Compatible
        ================================================================= */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--color-background);
            color: var(--color-dark-neutral);
            line-height: 1.4;
            padding: 16px;
            margin: 0;
        }

        /* =================================================================
           STORYLINE-OPTIMIZED CARD LAYOUT
        ================================================================= */
        .widget-card {
            background: var(--color-background);
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(28, 44, 76, 0.06);
            padding: 20px;
            width: 100%;
            max-width: 100%;
            border: 1px solid var(--color-border);
            min-height: calc(100vh - 32px);
        }

        .widget-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 12px;
        }

        .logo {
            max-height: 24px;
            width: auto;
        }

        .widget-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-dark-neutral);
        }

        /* =================================================================
           COMPACT FORM STYLES
        ================================================================= */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--color-dark-neutral);
            margin-bottom: 4px;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
            background: var(--color-background);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(26, 110, 246, 0.1);
        }

        .password-wrapper {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--color-primary);
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            padding: 4px;
        }

        .password-toggle:focus {
            outline: 1px solid var(--color-primary);
            outline-offset: 1px;
            border-radius: 3px;
        }

        /* =================================================================
           COMPACT BUTTONS
        ================================================================= */
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-family: var(--font-family);
        }

        .btn-primary {
            background-color: var(--color-cta);
            color: white;
        }

        .btn-primary:hover {
            background-color: #e55a4c;
        }

        .btn-secondary {
            background-color: var(--color-background-soft);
            color: var(--color-dark-neutral);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background-color: #edf1f7;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        /* =================================================================
           COMPACT STRENGTH METER
        ================================================================= */
        .strength-meter {
            margin: 16px 0;
        }

        .strength-label {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 6px;
        }

        .strength-bar {
            width: 100%;
            height: 6px;
            background-color: var(--color-border);
            border-radius: 3px;
            overflow: hidden;
        }

        .strength-fill {
            height: 100%;
            transition: width 0.3s ease, background-color 0.3s ease;
            border-radius: 3px;
        }

        .strength-weak { background-color: var(--color-cta); }
        .strength-fair { background-color: var(--color-warning); }
        .strength-good { background-color: var(--color-primary); }
        .strength-strong { background-color: var(--color-success); }

        /* =================================================================
           COMPACT CHECKLIST
        ================================================================= */
        .requirements-list {
            background: var(--color-background-soft);
            border-radius: 6px;
            padding: 12px;
            margin: 16px 0;
        }

        .requirements-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--color-dark-neutral);
        }

        .requirement-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
            font-size: 12px;
        }

        .requirement-item:last-child {
            margin-bottom: 0;
        }

        .requirement-check {
            width: 14px;
            height: 14px;
            border: 1px solid var(--color-border);
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .requirement-check.met {
            background-color: var(--color-success);
            border-color: var(--color-success);
            color: white;
        }

        /* =================================================================
           COMPACT SUCCESS STATE
        ================================================================= */
        .success-message {
            background: linear-gradient(135deg, rgba(28, 158, 111, 0.1), rgba(28, 158, 111, 0.05));
            border: 1px solid rgba(28, 158, 111, 0.2);
            border-radius: 6px;
            padding: 12px;
            margin: 16px 0;
            display: none;
            align-items: center;
            gap: 8px;
        }

        .success-message.show {
            display: flex;
        }

        .success-icon {
            color: var(--color-success);
            font-size: 16px;
            flex-shrink: 0;
        }

        .success-text {
            color: var(--color-success);
            font-weight: 500;
            font-size: 13px;
        }

        .success-subtitle {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
        }

        /* =================================================================
           COMPACT TIPS SECTION
        ================================================================= */
        .tips-section {
            background: rgba(26, 110, 246, 0.05);
            border-radius: 6px;
            padding: 12px;
            margin: 16px 0;
        }

        .tips-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--color-primary);
        }

        .tip-text {
            font-size: 12px;
            color: var(--color-dark-neutral);
        }

        /* =================================================================
           EXPANDABLE SECTION
        ================================================================= */
        .expandable {
            margin-top: 16px;
            border-top: 1px solid var(--color-border);
            padding-top: 12px;
        }

        .expandable-trigger {
            background: none;
            border: none;
            color: var(--color-primary);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .expandable-content {
            display: none;
            margin-top: 8px;
        }

        .expandable-content.show {
            display: block;
        }

        .expandable-content p {
            font-size: 11px;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        /* =================================================================
           TOAST - STORYLINE FRIENDLY
        ================================================================= */
        .toast {
            position: fixed;
            top: 10px;
            right: 10px;
            background: var(--color-dark-neutral);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            transform: translateY(-50px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* =================================================================
           STORYLINE RESPONSIVE
        ================================================================= */
        @media (max-width: 600px) {
            body {
                padding: 12px;
            }
            
            .widget-card {
                padding: 16px;
                min-height: calc(100vh - 24px);
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }

        @media (max-width: 400px) {
            .widget-title {
                font-size: 16px;
            }
            
            .form-input {
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }
    </style>
</head>
<body>
    <div class="widget-card">
        <!-- Header -->
        <div class="widget-header">
            <img id="logo" class="logo" alt="In-House Learning" />
            <h1 class="widget-title">Password Strength Check</h1>
        </div>

        <!-- Form -->
        <form id="passwordForm">
            <div class="form-group">
                <label for="name" class="form-label">Name (optional)</label>
                <input type="text" id="name" class="form-input" placeholder="Your name">
            </div>

            <div class="form-group">
                <label for="email" class="form-label">Email (optional)</label>
                <input type="email" id="email" class="form-input" placeholder="your.email@example.com">
            </div>

            <div class="form-group">
                <label for="password" class="form-label">Password</label>
                <div class="password-wrapper">
                    <input type="password" id="password" class="form-input" placeholder="Enter your password" style="padding-right: 50px;">
                    <button type="button" id="togglePassword" class="password-toggle">Show</button>
                </div>
            </div>

            <div class="button-group">
                <button type="button" id="generateBtn" class="btn btn-primary" title="Creates a high-entropy password you can copy">Generate Strong Password</button>
                <button type="button" id="copyBtn" class="btn btn-secondary">Copy</button>
            </div>
        </form>

        <!-- Strength Meter -->
        <div class="strength-meter">
            <div class="strength-label" id="strengthLabel">Enter a password to check its strength</div>
            <div class="strength-bar">
                <div class="strength-fill" id="strengthFill" style="width: 0%;"></div>
            </div>
        </div>

        <!-- Requirements Checklist -->
        <div class="requirements-list">
            <div class="requirements-title">Password Requirements</div>
            <div class="requirement-item">
                <div class="requirement-check" id="req-length">✓</div>
                <span>At least 12 characters</span>
            </div>
            <div class="requirement-item">
                <div class="requirement-check" id="req-lowercase">✓</div>
                <span>At least 1 lowercase letter</span>
            </div>
            <div class="requirement-item">
                <div class="requirement-check" id="req-uppercase">✓</div>
                <span>At least 1 uppercase letter</span>
            </div>
            <div class="requirement-item">
                <div class="requirement-check" id="req-number">✓</div>
                <span>At least 1 number</span>
            </div>
            <div class="requirement-item">
                <div class="requirement-check" id="req-symbol">✓</div>
                <span>At least 1 symbol</span>
            </div>
            <div class="requirement-item">
                <div class="requirement-check" id="req-spaces">✓</div>
                <span>No spaces</span>
            </div>
            <div class="requirement-item">
                <div class="requirement-check" id="req-common">✓</div>
                <span>Not a common password or pattern</span>
            </div>
            <div class="requirement-item">
                <div class="requirement-check" id="req-personal">✓</div>
                <span>Not your name or email</span>
            </div>
            <div class="requirement-item">
                <div class="requirement-check" id="req-repeated">✓</div>
                <span>No 4+ repeated characters</span>
            </div>
        </div>

        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            <span class="success-icon">✓</span>
            <div>
                <div class="success-text">Looks strong. You could use this.</div>
                <div class="success-subtitle">Remember to store passwords safely in a password manager.</div>
            </div>
        </div>

        <!-- Tips Section -->
        <div class="tips-section" id="tipsSection">
            <div class="tips-title">💡 Pro Tip</div>
            <div class="tip-text" id="tipText">Use a mix of unrelated words with numbers and symbols for memorable strength.</div>
        </div>

        <!-- Expandable Why Section -->
        <div class="expandable">
            <button type="button" class="expandable-trigger" id="whyTrigger">
                Why this matters ▼
            </button>
            <div class="expandable-content" id="whyContent">
                <p><strong>12+ characters:</strong> Exponentially harder to crack with each additional character.</p>
                <p><strong>Mixed case & symbols:</strong> Increases the possible character combinations dramatically.</p>
                <p><strong>No common passwords:</strong> Prevents attacks using known password lists.</p>
                <p><strong>No personal info:</strong> Attackers often try combinations of your known information.</p>
                <p><strong>No patterns:</strong> Keyboard sequences and repeated characters are easily guessed.</p>
            </div>
        </div>
    </div>

    <!-- Toast for copy feedback -->
    <div id="toast" class="toast"></div>

    <script>
        // =================================================================
        // CONFIG - Storyline Optimized
        // =================================================================
        const logoSrc = "data:image/svg+xml,%3csvg width='100' height='32' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100' height='32' fill='%231A6EF6'/%3e%3ctext x='50' y='20' font-family='Arial' font-size='12' fill='white' text-anchor='middle'%3eIHL%3c/text%3e%3c/svg%3e";

        // Common passwords blacklist (condensed for Storyline)
        const commonPasswords = [
            'password', '123456', 'qwerty', 'abc123', 'letmein', 'admin', 'welcome',
            'iloveyou', 'football', 'monkey', 'passw0rd', '123456789', '12345678',
            'sunshine', 'master', 'shadow', 'superman', 'michael', 'jessica',
            'mustang', 'access', 'trustno1', 'batman', 'hunter2'
        ];

        // Keyboard patterns (simplified)
        const keyboardPatterns = [
            'qwerty', 'asdf', 'zxcv', '1234', 'abcd', 'qwertyui', 'asdfgh',
            'zxcvbn', '123456', 'abcdef', '987654', 'fedcba'
        ];

        // Pro tips array
        const proTips = [
            "Use a mix of unrelated words with numbers and symbols for memorable strength.",
            "Consider using a passphrase: 4+ random words are often stronger than complex short passwords.",
            "Avoid personal information like birthdays, names, or common dictionary words.",
            "Use unique passwords for every account - password managers make this easy.",
            "The longer the password, the stronger it becomes exponentially."
        ];

        let currentTipIndex = 0;

        // =================================================================
        // DOM ELEMENTS
        // =================================================================
        const elements = {
            logo: document.getElementById('logo'),
            name: document.getElementById('name'),
            email: document.getElementById('email'),
            password: document.getElementById('password'),
            togglePassword: document.getElementById('togglePassword'),
            generateBtn: document.getElementById('generateBtn'),
            copyBtn: document.getElementById('copyBtn'),
            strengthLabel: document.getElementById('strengthLabel'),
            strengthFill: document.getElementById('strengthFill'),
            successMessage: document.getElementById('successMessage'),
            tipsSection: document.getElementById('tipsSection'),
            tipText: document.getElementById('tipText'),
            whyTrigger: document.getElementById('whyTrigger'),
            whyContent: document.getElementById('whyContent'),
            toast: document.getElementById('toast'),
            requirements: {
                length: document.getElementById('req-length'),
                lowercase: document.getElementById('req-lowercase'),
                uppercase: document.getElementById('req-uppercase'),
                number: document.getElementById('req-number'),
                symbol: document.getElementById('req-symbol'),
                spaces: document.getElementById('req-spaces'),
                common: document.getElementById('req-common'),
                personal: document.getElementById('req-personal'),
                repeated: document.getElementById('req-repeated')
            }
        };

        // =================================================================
        // INITIALIZATION
        // =================================================================
        function init() {
            elements.logo.src = logoSrc;
            
            // Event listeners
            elements.password.addEventListener('input', handlePasswordInput);
            elements.name.addEventListener('input', handlePasswordInput);
            elements.email.addEventListener('input', handlePasswordInput);
            elements.togglePassword.addEventListener('click', togglePasswordVisibility);
            elements.generateBtn.addEventListener('click', generateStrongPassword);
            elements.copyBtn.addEventListener('click', copyPassword);
            elements.whyTrigger.addEventListener('click', toggleExpandable);

            // Initialize tip rotation
            rotateTips();
            
            // Storyline communication
            notifyStorylineReady();
        }

        // =================================================================
        // STORYLINE COMMUNICATION
        // =================================================================
        function notifyStorylineReady() {
            // Signal to Storyline that widget is ready
            if (window.parent && window.parent.postMessage) {
                window.parent.postMessage({
                    type: 'widget-ready',
                    source: 'password-strength-widget'
                }, '*');
            }
        }

        function notifyStorylineProgress(data) {
            // Send progress updates to Storyline
            if (window.parent && window.parent.postMessage) {
                window.parent.postMessage({
                    type: 'widget-progress',
                    source: 'password-strength-widget',
                    data: data
                }, '*');
            }
        }

        // =================================================================
        // PASSWORD VALIDATION
        // =================================================================
        function validatePassword(password) {
            const name = elements.name.value.toLowerCase();
            const email = elements.email.value.toLowerCase();
            const lowercasePassword = password.toLowerCase();

            return {
                length: password.length >= 12,
                lowercase: /[a-z]/.test(password),
                uppercase: /[A-Z]/.test(password),
                number: /\d/.test(password),
                symbol: /[!@#$%^&*()_+\-=\[\]{}|;:'",.<>/?]/.test(password),
                spaces: !/\s/.test(password),
                common: !isCommonPassword(lowercasePassword),
                personal: !containsPersonalInfo(lowercasePassword, name, email),
                repeated: !hasRepeatedChars(password)
            };
        }

        function isCommonPassword(password) {
            return commonPasswords.includes(password) || 
                   keyboardPatterns.some(pattern => password.includes(pattern));
        }

        function containsPersonalInfo(password, name, email) {
            if (!name && !email) return false;
            
            if (name && name.length > 2 && password.includes(name)) return true;
            if (email && email.length > 2) {
                const emailName = email.split('@')[0];
                if (emailName.length > 2 && password.includes(emailName)) return true;
            }
            return false;
        }

        function hasRepeatedChars(password) {
            return /(.)\1{3,}/.test(password);
        }

        function calculateStrength(password, validation) {
            if (!password) return 0;

            let score = 0;
            const length = password.length;

            // Length scoring (0-40 points)
            if (length >= 12) score += 15;
            if (length >= 16) score += 10;
            if (length >= 20) score += 15;

            // Character diversity (0-40 points)
            if (validation.lowercase) score += 10;
            if (validation.uppercase) score += 10;
            if (validation.number) score += 10;
            if (validation.symbol) score += 10;

            // Security checks (0-20 points)
            if (validation.spaces) score += 5;
            if (validation.common) score += 5;
            if (validation.personal) score += 5;
            if (validation.repeated) score += 5;

            return Math.min(score, 100);
        }

        // =================================================================
        // UI UPDATES
        // =================================================================
        function updateRequirements(validation) {
            Object.keys(validation).forEach(key => {
                const element = elements.requirements[key];
                if (element) {
                    element.classList.toggle('met', validation[key]);
                    element.textContent = validation[key] ? '✓' : '';
                }
            });
        }

        function updateStrengthMeter(score) {
            const fill = elements.strengthFill;
            const label = elements.strengthLabel;

            fill.style.width = `${score}%`;
            
            // Remove all strength classes
            fill.classList.remove('strength-weak', 'strength-fair', 'strength-good', 'strength-strong');
            
            if (score === 0) {
                label.textContent = 'Enter a password to check its strength';
            } else if (score < 40) {
                label.textContent = 'Weak';
                fill.classList.add('strength-weak');
            } else if (score < 60) {
                label.textContent = 'Fair';
                fill.classList.add('strength-fair');
            } else if (score < 80) {
                label.textContent = 'Good';
                fill.classList.add('strength-good');
            } else {
                label.textContent = 'Strong';
                fill.classList.add('strength-strong');
            }
        }

        function updateSuccessState(isStrong) {
            elements.successMessage.classList.toggle('show', isStrong);
            elements.tipsSection.style.display = isStrong ? 'none' : 'block';
        }

        // =================================================================
        // EVENT HANDLERS
        // =================================================================
        function handlePasswordInput() {
            const password = elements.password.value;
            const validation = validatePassword(password);
            const score = calculateStrength(password, validation);
            const isStrong = score >= 80 && Object.values(validation).every(v => v);

            updateRequirements(validation);
            updateStrengthMeter(score);
            updateSuccessState(isStrong);

            // Notify Storyline of progress
            notifyStorylineProgress({
                score: score,
                isStrong: isStrong,
                validationPassed: Object.values(validation).filter(v => v).length,
                totalValidations: Object.keys(validation).length
            });
        }

        function togglePasswordVisibility() {
            const passwordField = elements.password;
            const toggleBtn = elements.togglePassword;
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggleBtn.textContent = 'Hide';
            } else {
                passwordField.type = 'password';
                toggleBtn.textContent = 'Show';
            }
            
            passwordField.focus();
        }

        function generateStrongPassword() {
            // Character sets excluding confusing characters
            const lowercase = 'abcdefghijkmnopqrstuvwxyz';
            const uppercase = 'ABCDEFGHJKLMNPQRSTUVWXYZ';
            const numbers = '23456789';
            const symbols = '!@#$%^&*()_+-=[]{}|;:,.<>?';
            
            const length = 16 + Math.floor(Math.random() * 5); // 16-20 chars
            let password = '';
            
            // Ensure at least one from each required set
            password += getRandomChar(lowercase);
            password += getRandomChar(uppercase);
            password += getRandomChar(numbers);
            password += getRandomChar(symbols);
            
            // Fill the rest randomly
            const allChars = lowercase + uppercase + numbers + symbols;
            for (let i = 4; i < length; i++) {
                password += getRandomChar(allChars);
            }
            
            // Shuffle the password
            password = password.split('').sort(() => Math.random() - 0.5).join('');
            
            // Verify it's not blacklisted (regenerate if needed)
            if (isCommonPassword(password.toLowerCase())) {
                return generateStrongPassword();
            }
            
            elements.password.value = password;
            handlePasswordInput();
        }

        function getRandomChar(charset) {
            return charset.charAt(Math.floor(Math.random() * charset.length));
        }

        function copyPassword() {
            const password = elements.password.value;
            
            if (!password) {
                showToast('No password to copy');
                return;
            }
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(password).then(() => {
                    showToast('Copied');
                }).catch(() => {
                    fallbackCopy();
                });
            } else {
                fallbackCopy();
            }
        }

        function fallbackCopy() {
            try {
                elements.password.select();
                elements.password.setSelectionRange(0, 99999); // For mobile
                document.execCommand('copy');
                showToast('Copied');
            } catch (err) {
                showToast('Couldn\'t copy—select and press Ctrl/Cmd+C');
            }
        }

        function showToast(message) {
            const toast = elements.toast;
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        function toggleExpandable() {
            const content = elements.whyContent;
            const trigger = elements.whyTrigger;
            
            content.classList.toggle('show');
            trigger.textContent = content.classList.contains('show') 
                ? 'Why this matters ▲' 
                : 'Why this matters ▼';
        }

        function rotateTips() {
            if (elements.tipsSection.style.display !== 'none') {
                elements.tipText.textContent = proTips[currentTipIndex];
                currentTipIndex = (currentTipIndex + 1) % proTips.length;
            }
            
            setTimeout(rotateTips, 5000); // Rotate every 5 seconds
        }

        // =================================================================
        // START THE WIDGET
        // =================================================================
        document.addEventListener('DOMContentLoaded', init);

        // Handle messages from Storyline
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'storyline-command') {
                switch(event.data.command) {
                    case 'reset':
                        elements.password.value = '';
                        elements.name.value = '';
                        elements.email.value = '';
                        handlePasswordInput();
                        break;
                    case 'get-status':
                        const password = elements.password.value;
                        const validation = validatePassword(password);
                        const score = calculateStrength(password, validation);
                        notifyStorylineProgress({
                            score: score,
                            isStrong: score >= 80 && Object.values(validation).every(v => v),
                            password: password
                        });
                        break;
                }
            }
        });
    </script>
</body>
</html>